import{I as p}from"./chunks/index.b9c36b78.js";import{_ as o,c as e,a,b as l,d as c,o as t}from"./app.2e15d874.js";const r="/docs/assets/image-20210731141907366.65061691.png",i="/docs/assets/image-20210731142219735.ef98b75d.png",C="/docs/assets/image-20210731143401460.48aaed38.png",y="/docs/assets/image-20210731144304990.a94333a1.png",D="/docs/assets/image-20210731144458680.852ecaad.png",d="/docs/assets/image-20210731144820638.d049b180.png",A="/docs/assets/image-20210731153059464.ed82be9f.png",h="/docs/assets/image-20210731153743354.ea5bf86c.png",F="/docs/assets/image-20210731154257653.bc85b2dd.png",g="/docs/assets/image-20210102095454656-16447079264661.0a4f1756.png",m="/docs/assets/image-20210731155002425.ea373d34.png",u="/docs/assets/image-20210731155141362.772457ad.png",k="/docs/assets/image-20210731155649535.52f27737.png",E="/docs/assets/image-20210731155844368.d49bcde5.png",_="/docs/assets/image-20210731155856199.fa958d9a.png",b="/docs/assets/image-20210731155903037.2d2ec357.png",v="/docs/assets/image-20210731161104732.076734d4.png",B="/docs/assets/image-20210731161354344.3a074d8f.png",f="/docs/assets/image-20210731161746245.fe951b43.png",x="/docs/assets/1592730146935.6bc322c0.png",q="/docs/assets/image-20210731161950495.a21eaa10.png",n="/docs/assets/image-20211025111445658.678f0644.png",$="/docs/assets/image-20210102142146702.99dbd7ed.png",j="/docs/assets/image-20210731172440275.23b38bb4.png",S="/docs/assets/1592748818477-16447092724172.4958ffa0.png",O="/docs/assets/image-20210731173541846.a74a7f69.png",T="/docs/assets/1592748888266.80d5cabb.png",R="/docs/assets/image-20210731173746910.2f1e2cf8.png",P="/docs/assets/image-20210731173809877.a1d5d84b.png",L="/docs/assets/image-20210731175155453.d20c1f7e.png",M="/docs/assets/1573649804623.23f39bcf.png",Q="/docs/assets/image-20210202162536188.a56b8bbc.png",I="/docs/assets/image-20210102154718339.0dbf2787.png",N="/docs/assets/image-20210102160247890.a26027fc.png",H="/docs/assets/image-20210731175806273.30961cf7.png",U="/docs/assets/image-20210731180321133.a1cada7b.png",w="/docs/assets/image-20210801101207444.16385f1c.png",J="/docs/assets/image-20210801101314816.9d757859.png",V="/docs/assets/image-20210801101410200.cf47e546.png",W="/docs/assets/image-20210801101455590.6047cc75.png",Y="/docs/assets/image-20210731180921742.8ff9bbca.png",z="/docs/assets/image-20210731181341330.b4b3ac09.png",K="/docs/assets/image-20210801095205034.3350632e.png",X="/docs/assets/image-20210801095320586.b95c2c3f.png",G="/docs/assets/image-20210801095951030.5a3ef44e.png",Z="/docs/assets/image-20210801100201253.a6f80a2f.png",ss="/docs/assets/image-20210801100231495.3694baa1.png",as="/docs/assets/image-20210801100308102.6ecd0958.png",ns="/docs/assets/image-20210801100955653.760e5348.png",ls="/docs/assets/image-20220213144552867.b3f28dda.png",ps="/docs/assets/1592729755943.637eaa6b.png",gs=JSON.parse('{"title":"Docker-容器化技术","description":"","frontmatter":{},"headers":[{"level":2,"title":"1.1.什么是Docker","slug":"_1-1-什么是docker","link":"#_1-1-什么是docker","children":[{"level":3,"title":"1.1.1.应用部署的环境问题","slug":"_1-1-1-应用部署的环境问题","link":"#_1-1-1-应用部署的环境问题","children":[]},{"level":3,"title":"1.1.2.Docker解决依赖兼容问题","slug":"_1-1-2-docker解决依赖兼容问题","link":"#_1-1-2-docker解决依赖兼容问题","children":[]},{"level":3,"title":"1.1.3.Docker解决","slug":"_1-1-3-docker解决","link":"#_1-1-3-docker解决","children":[]}]},{"level":2,"title":"1.2.Docker和虚拟机的区别","slug":"_1-2-docker和虚拟机的区别","link":"#_1-2-docker和虚拟机的区别","children":[]},{"level":2,"title":"1.3.Docker架构","slug":"_1-3-docker架构","link":"#_1-3-docker架构","children":[{"level":3,"title":"1.3.1.镜像和容器","slug":"_1-3-1-镜像和容器","link":"#_1-3-1-镜像和容器","children":[]},{"level":3,"title":"1.3.2.DockerHub","slug":"_1-3-2-dockerhub","link":"#_1-3-2-dockerhub","children":[]},{"level":3,"title":"1.3.3.Docker架构","slug":"_1-3-3-docker架构","link":"#_1-3-3-docker架构","children":[]},{"level":3,"title":"1.3.4.小结","slug":"_1-3-4-小结","link":"#_1-3-4-小结","children":[]}]},{"level":2,"title":"1.4.安装Docker","slug":"_1-4-安装docker","link":"#_1-4-安装docker","children":[]},{"level":2,"title":"2.0 Docker服务相关命令【掌握】","slug":"_2-0-docker服务相关命令【掌握】","link":"#_2-0-docker服务相关命令【掌握】","children":[]},{"level":2,"title":"2.1.镜像操作【掌握】","slug":"_2-1-镜像操作【掌握】","link":"#_2-1-镜像操作【掌握】","children":[{"level":3,"title":"2.1.1.镜像名称","slug":"_2-1-1-镜像名称","link":"#_2-1-1-镜像名称","children":[]},{"level":3,"title":"2.1.2.镜像命令","slug":"_2-1-2-镜像命令","link":"#_2-1-2-镜像命令","children":[]},{"level":3,"title":"2.1.3.案例1-拉取、查看镜像","slug":"_2-1-3-案例1-拉取、查看镜像","link":"#_2-1-3-案例1-拉取、查看镜像","children":[]},{"level":3,"title":"2.1.4.案例2-保存、导入镜像","slug":"_2-1-4-案例2-保存、导入镜像","link":"#_2-1-4-案例2-保存、导入镜像","children":[]},{"level":3,"title":"2.1.5.练习","slug":"_2-1-5-练习","link":"#_2-1-5-练习","children":[]},{"level":3,"title":"小结：（镜像相关命令）","slug":"小结-镜像相关命令","link":"#小结-镜像相关命令","children":[]}]},{"level":2,"title":"2.2.容器操作【掌握】","slug":"_2-2-容器操作【掌握】","link":"#_2-2-容器操作【掌握】","children":[{"level":3,"title":"2.2.1.容器相关命令","slug":"_2-2-1-容器相关命令","link":"#_2-2-1-容器相关命令","children":[]},{"level":3,"title":"2.2.2 查看容器","slug":"_2-2-2-查看容器","link":"#_2-2-2-查看容器","children":[]},{"level":3,"title":"2.2.3 创建并启动容器","slug":"_2-2-3-创建并启动容器","link":"#_2-2-3-创建并启动容器","children":[]},{"level":3,"title":"2.2.4 进入容器","slug":"_2-2-4-进入容器","link":"#_2-2-4-进入容器","children":[]},{"level":3,"title":"2.2.5 停止容器","slug":"_2-2-5-停止容器","link":"#_2-2-5-停止容器","children":[]},{"level":3,"title":"2.2.6 启动容器","slug":"_2-2-6-启动容器","link":"#_2-2-6-启动容器","children":[]},{"level":3,"title":"2.2.7 删除容器","slug":"_2-2-7-删除容器","link":"#_2-2-7-删除容器","children":[]},{"level":3,"title":"2.2.8 案例-创建并运行一个容器","slug":"_2-2-8-案例-创建并运行一个容器","link":"#_2-2-8-案例-创建并运行一个容器","children":[]},{"level":3,"title":"2.2.9 案例-进入容器，查看容器内部","slug":"_2-2-9-案例-进入容器-查看容器内部","link":"#_2-2-9-案例-进入容器-查看容器内部","children":[]},{"level":3,"title":"小结：（容器相关命令）","slug":"小结-容器相关命令","link":"#小结-容器相关命令","children":[]}]},{"level":2,"title":"2.3.数据卷（容器数据管理）","slug":"_2-3-数据卷-容器数据管理","link":"#_2-3-数据卷-容器数据管理","children":[{"level":3,"title":"2.3.1.什么是数据卷","slug":"_2-3-1-什么是数据卷","link":"#_2-3-1-什么是数据卷","children":[]},{"level":3,"title":"2.3.2.数据集操作命令","slug":"_2-3-2-数据集操作命令","link":"#_2-3-2-数据集操作命令","children":[]},{"level":3,"title":"2.3.3.创建和查看数据卷","slug":"_2-3-3-创建和查看数据卷","link":"#_2-3-3-创建和查看数据卷","children":[]},{"level":3,"title":"2.3.4.数据卷挂载","slug":"_2-3-4-数据卷挂载","link":"#_2-3-4-数据卷挂载","children":[]},{"level":3,"title":"2.3.5.目录挂载","slug":"_2-3-5-目录挂载","link":"#_2-3-5-目录挂载","children":[]},{"level":3,"title":"2.3.6.案例需求： 部署一个网页项目到tomcat容器中.","slug":"_2-3-6-案例需求-部署一个网页项目到tomcat容器中","link":"#_2-3-6-案例需求-部署一个网页项目到tomcat容器中","children":[]},{"level":3,"title":"2.3.7.案例-给MySQL挂载本地目录","slug":"_2-3-7-案例-给mysql挂载本地目录","link":"#_2-3-7-案例-给mysql挂载本地目录","children":[]},{"level":3,"title":"2.3.8 部署Redis","slug":"_2-3-8-部署redis","link":"#_2-3-8-部署redis","children":[]},{"level":3,"title":"2.3.9.小结","slug":"_2-3-9-小结","link":"#_2-3-9-小结","children":[]}]},{"level":2,"title":"3.1.镜像结构","slug":"_3-1-镜像结构","link":"#_3-1-镜像结构","children":[]},{"level":2,"title":"3.2.Dockerfile语法","slug":"_3-2-dockerfile语法","link":"#_3-2-dockerfile语法","children":[]},{"level":2,"title":"3.3.构建Java项目","slug":"_3-3-构建java项目","link":"#_3-3-构建java项目","children":[{"level":3,"title":"3.3.1.基于Ubuntu构建Java项目","slug":"_3-3-1-基于ubuntu构建java项目","link":"#_3-3-1-基于ubuntu构建java项目","children":[]},{"level":3,"title":"3.3.2.基于java8构建Java项目","slug":"_3-3-2-基于java8构建java项目","link":"#_3-3-2-基于java8构建java项目","children":[]}]},{"level":2,"title":"3.4.小结","slug":"_3-4-小结","link":"#_3-4-小结","children":[]},{"level":2,"title":"4.1.初识DockerCompose","slug":"_4-1-初识dockercompose","link":"#_4-1-初识dockercompose","children":[]},{"level":2,"title":"4.2.安装DockerCompose","slug":"_4-2-安装dockercompose","link":"#_4-2-安装dockercompose","children":[]},{"level":2,"title":"4.3.部署微服务集群","slug":"_4-3-部署微服务集群","link":"#_4-3-部署微服务集群","children":[{"level":3,"title":"4.3.1.compose文件","slug":"_4-3-1-compose文件","link":"#_4-3-1-compose文件","children":[]},{"level":3,"title":"4.3.2.修改微服务配置","slug":"_4-3-2-修改微服务配置","link":"#_4-3-2-修改微服务配置","children":[]},{"level":3,"title":"4.3.3.打包","slug":"_4-3-3-打包","link":"#_4-3-3-打包","children":[]},{"level":3,"title":"4.3.4.拷贝jar包到部署目录","slug":"_4-3-4-拷贝jar包到部署目录","link":"#_4-3-4-拷贝jar包到部署目录","children":[]},{"level":3,"title":"4.3.5.部署","slug":"_4-3-5-部署","link":"#_4-3-5-部署","children":[]}]},{"level":2,"title":"5.1.搭建私有镜像仓库","slug":"_5-1-搭建私有镜像仓库","link":"#_5-1-搭建私有镜像仓库","children":[]},{"level":2,"title":"5.2.推送、拉取镜像","slug":"_5-2-推送、拉取镜像","link":"#_5-2-推送、拉取镜像","children":[{"level":3,"title":"1. ip addr不显示ip地址怎么办？","slug":"_1-ip-addr不显示ip地址怎么办","link":"#_1-ip-addr不显示ip地址怎么办","children":[]}]}],"relativePath":"zh/java/面试重点技术/05-Docker课程讲义/Docker实用篇.md","lastUpdated":1675892686000}'),os={name:"zh/java/面试重点技术/05-Docker课程讲义/Docker实用篇.md"},es=l('<h1 id="docker-容器化技术" tabindex="-1">Docker-容器化技术 <a class="header-anchor" href="#docker-容器化技术" aria-hidden="true">#</a></h1><blockquote><p>统一运行环境（运维的范畴）</p></blockquote><h1 id="_0-学习目标" tabindex="-1">0.学习目标 <a class="header-anchor" href="#_0-学习目标" aria-hidden="true">#</a></h1><ul><li>了解Docker和虚拟机的差别</li><li>能利用Docker命令操作镜像</li><li>能利用Docker命令操作容器</li><li>能操作容器的数据卷</li></ul><h1 id="_1-初识docker" tabindex="-1">1.初识Docker <a class="header-anchor" href="#_1-初识docker" aria-hidden="true">#</a></h1><h2 id="_1-1-什么是docker" tabindex="-1">1.1.什么是Docker <a class="header-anchor" href="#_1-1-什么是docker" aria-hidden="true">#</a></h2><p>微服务虽然具备各种各样的优势，但服务的拆分通用给部署带来了很大的麻烦。</p><ul><li>分布式系统中，依赖的组件非常多，不同组件之间部署时往往会产生一些冲突。</li><li>在数百上千台服务中重复部署，环境不一定一致，会遇到各种问题</li></ul><h3 id="_1-1-1-应用部署的环境问题" tabindex="-1">1.1.1.应用部署的环境问题 <a class="header-anchor" href="#_1-1-1-应用部署的环境问题" aria-hidden="true">#</a></h3><p>大型项目组件较多，运行环境也较为复杂，部署时会碰到一些问题：</p><ul><li><p>依赖关系复杂，容易出现兼容性问题</p></li><li><p>开发、测试、生产环境有差异</p></li></ul><p><img src="'+r+'" alt="image-20210731141907366"></p><p>例如一个项目中，部署时需要依赖于node.js、Redis、RabbitMQ、MySQL等，这些服务部署时所需要的函数库、依赖项各不相同，甚至会有冲突。给部署带来了极大的困难。</p><h3 id="_1-1-2-docker解决依赖兼容问题" tabindex="-1">1.1.2.Docker解决依赖兼容问题 <a class="header-anchor" href="#_1-1-2-docker解决依赖兼容问题" aria-hidden="true">#</a></h3><p>而Docker确巧妙的解决了这些问题，Docker是如何实现的呢？</p><p>Docker为了解决依赖的兼容问题的，采用了两个手段：</p><ul><li><p>将应用的Libs（函数库）、Deps（依赖）、配置与应用一起打包</p></li><li><p>将每个应用放到一个隔离<strong>容器</strong>去运行，避免互相干扰</p></li></ul><p><img src="'+i+'" alt="image-20210731142219735"></p><p>这样打包好的应用包中，既包含应用本身，也保护应用所需要的Libs、Deps，无需再操作系统上安装这些，自然就不存在不同应用之间的兼容问题了。</p><p>虽然解决了不同应用的兼容问题，但是开发、测试等环境会存在差异，操作系统版本也会有差异，怎么解决这些问题呢？</p><h3 id="_1-1-3-docker解决" tabindex="-1">1.1.3.Docker解决 <a class="header-anchor" href="#_1-1-3-docker解决" aria-hidden="true">#</a></h3><p>要解决不同操作系统环境差异问题，必须先了解操作系统结构。以一个Ubuntu操作系统为例，结构如下：</p><p><img src="'+C+'" alt="image-20210731143401460"></p><p>结构包括：</p><ul><li>计算机硬件：例如CPU、内存、磁盘等</li><li>系统内核：所有Linux发行版的内核都是Linux，例如CentOS、Ubuntu、Fedora等。内核可以与计算机硬件交互，对外提供<strong>内核指令</strong>，用于操作计算机硬件。</li><li>系统应用：操作系统本身提供的应用、函数库。这些函数库是对内核指令的封装，使用更加方便。</li></ul><p>应用于计算机交互的流程如下：</p><p>1）应用调用操作系统应用（函数库），实现各种功能</p><p>2）系统函数库是对内核指令集的封装，会调用内核指令</p><p>3）内核指令操作计算机硬件</p><p>Ubuntu和CentOS 都是基于Linux内核，无非是系统应用不同，提供的函数库有差异：</p><p><img src="'+y+'" alt="image-20210731144304990"></p><p>此时，如果将一个Ubuntu版本的MySQL应用安装到CentOS系统，MySQL在调用Ubuntu函数库时，会发现找不到或者不匹配，就会报错了：</p><p><img src="'+D+'" alt="image-20210731144458680"></p><p><strong>Docker如何解决不同系统环境的问题？</strong></p><ul><li>Docker将用户程序与所需要调用的系统(比如Ubuntu)函数库一起打包</li><li>Docker运行到不同操作系统时，直接基于打包的函数库，借助于操作系统的Linux内核来运行</li></ul><p>如图：</p><p><img src="'+d+'" alt="image-20210731144820638"></p><h4 id="小结" tabindex="-1">小结: <a class="header-anchor" href="#小结" aria-hidden="true">#</a></h4><blockquote><p>Docker如何解决大型项目依赖关系复杂，不同组件依赖的兼容性问题？</p><ul><li>Docker允许开发中将应用、依赖、函数库、配置一起<strong>打包</strong>，形成可移植镜像</li><li>Docker应用运行在容器中，使用沙箱机制，相互<strong>隔离</strong></li></ul><p>Docker如何解决开发、测试、生产环境有差异的问题？</p><ul><li>Docker镜像中包含完整运行环境，包括系统函数库，仅依赖系统的Linux内核，因此可以在任意Linux操作系统上运行</li></ul><p>Docker是一个快速交付应用、运行应用的技术，具备下列优势：</p><ul><li>可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统</li><li>运行时利用沙箱机制形成隔离容器，各个应用互不干扰</li><li>启动、移除都可以通过一行命令完成，方便快捷</li></ul></blockquote><h2 id="_1-2-docker和虚拟机的区别" tabindex="-1">1.2.Docker和虚拟机的区别 <a class="header-anchor" href="#_1-2-docker和虚拟机的区别" aria-hidden="true">#</a></h2><p>Docker可以让一个应用在任何操作系统中非常方便的运行。而以前我们接触的虚拟机，也能在一个操作系统中，运行另外一个操作系统，保护系统中的任何应用。</p><p>两者有什么差异呢？</p><p><strong>虚拟机</strong>（virtual machine）是在操作系统中<strong>模拟</strong>硬件设备，然后运行另一个操作系统，比如在 Windows 系统里面运行 Ubuntu 系统，这样就可以运行任意的Ubuntu应用了。</p><p><strong>Docker</strong>仅仅是封装函数库，并没有模拟完整的操作系统，如图：</p>',44),cs=c("p",null,"对比来看：",-1),ts=l('<h4 id="小结-1" tabindex="-1">小结： <a class="header-anchor" href="#小结-1" aria-hidden="true">#</a></h4><blockquote><p>Docker和虚拟机的差异：</p><ul><li><p>docker是一个系统进程； 虚拟机是在操作系统中的操作系统</p></li><li><p>docker体积小、启动速度快、性能好； 虚拟机体积大、启动速度慢、性能一般</p></li></ul></blockquote><h2 id="_1-3-docker架构" tabindex="-1">1.3.Docker架构 <a class="header-anchor" href="#_1-3-docker架构" aria-hidden="true">#</a></h2><h3 id="_1-3-1-镜像和容器" tabindex="-1">1.3.1.镜像和容器 <a class="header-anchor" href="#_1-3-1-镜像和容器" aria-hidden="true">#</a></h3><p>Docker中有几个重要的概念：</p><p><strong>镜像（Image）</strong>：Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。</p><p><strong>容器（Container）</strong>：镜像中的应用程序运行后形成的进程就是<strong>容器</strong>，只是Docker会给容器进程做隔离，对外不可见。</p><p>一切应用最终都是代码组成，都是硬盘中的一个个的字节形成的<strong>文件</strong>。只有运行时，才会加载到内存，形成进程。</p><p>而<strong>镜像</strong>，就是把一个应用在硬盘上的文件、及其运行环境、部分系统函数库文件一起打包形成的文件包。这个文件包是只读的。</p><p><strong>容器</strong>呢，就是将这些文件中编写的程序、函数加载到内存中允许，形成进程，只不过要隔离起来。因此一个镜像可以启动多次，形成多个容器进程。</p><p><img src="'+A+'" alt="image-20210731153059464"></p><p>例如你下载了一个QQ，如果我们将QQ在磁盘上的运行<strong>文件</strong>及其运行的操作系统依赖打包，形成QQ镜像。然后你可以启动多次，双开、甚至三开QQ，跟多个妹子聊天。</p><h3 id="_1-3-2-dockerhub" tabindex="-1">1.3.2.DockerHub <a class="header-anchor" href="#_1-3-2-dockerhub" aria-hidden="true">#</a></h3><p>开源应用程序非常多，打包这些应用往往是重复的劳动。为了避免这些重复劳动，人们就会将自己打包的应用镜像，例如Redis、MySQL镜像放到网络上，共享使用，就像GitHub的代码共享一样。</p><ul><li><p>DockerHub：DockerHub是一个官方的Docker镜像的托管平台。这样的平台称为Docker Registry。</p></li><li><p>国内也有类似于DockerHub 的公开服务，比如 <a href="https://c.163yun.com/hub" target="_blank" rel="noreferrer">网易云镜像服务</a>、<a href="https://cr.console.aliyun.com/" target="_blank" rel="noreferrer">阿里云镜像库</a>等。</p></li></ul><p>我们一方面可以将自己的镜像共享到DockerHub，另一方面也可以从DockerHub拉取镜像：</p><p><img src="'+h+'" alt="image-20210731153743354"></p><h3 id="_1-3-3-docker架构" tabindex="-1">1.3.3.Docker架构 <a class="header-anchor" href="#_1-3-3-docker架构" aria-hidden="true">#</a></h3><p>我们要使用Docker来操作镜像、容器，就必须要安装Docker。</p><p>Docker是一个CS架构的程序，由两部分组成：</p><ul><li><p>服务端(server)：Docker守护进程，负责处理Docker指令，管理镜像、容器等</p></li><li><p>客户端(client)：通过命令或RestAPI向Docker服务端发送指令。可以在本地或远程向服务端发送指令。</p></li></ul><p>如图：</p><p><img src="'+F+'" alt="image-20210731154257653"></p><h3 id="_1-3-4-小结" tabindex="-1">1.3.4.小结 <a class="header-anchor" href="#_1-3-4-小结" aria-hidden="true">#</a></h3><blockquote><p><strong>镜像：</strong></p><ul><li>将应用程序及其依赖、环境、配置打包在一起</li></ul><p><strong>容器：</strong></p><ul><li>镜像运行起来就是容器，一个镜像可以运行多个容器</li></ul><p><strong>Docker架构：</strong></p><ul><li>服务端：接收命令或远程请求，操作镜像或容器</li><li>客户端：发送命令或者请求到Docker服务端</li></ul><p><strong>DockerHub：</strong></p><ul><li>一个镜像托管的服务器，类似的还有阿里云镜像服务，统称为DockerRegistry</li></ul></blockquote><blockquote><p>docker是一个统一运行环境的容器！</p></blockquote><p><img src="'+g+'" alt="image-20210102095454656"></p><h2 id="_1-4-安装docker" tabindex="-1">1.4.安装Docker <a class="header-anchor" href="#_1-4-安装docker" aria-hidden="true">#</a></h2><blockquote><p>挂载我给的虚拟机即可！</p></blockquote><p>企业部署一般都是采用Linux操作系统，而其中又数CentOS发行版占比最多，因此我们在CentOS下安装Docker。参考课前资料中的文档：</p><p><img src="'+m+`" alt="image-20210731155002425"></p><h1 id="_2-docker的基本操作" tabindex="-1">2.Docker的基本操作 <a class="header-anchor" href="#_2-docker的基本操作" aria-hidden="true">#</a></h1><h2 id="_2-0-docker服务相关命令【掌握】" tabindex="-1">2.0 Docker服务相关命令【掌握】 <a class="header-anchor" href="#_2-0-docker服务相关命令【掌握】" aria-hidden="true">#</a></h2><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看服务状态：</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 启动docker服务：</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 停止docker服务</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 重启docker服务</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-1-镜像操作【掌握】" tabindex="-1">2.1.镜像操作【掌握】 <a class="header-anchor" href="#_2-1-镜像操作【掌握】" aria-hidden="true">#</a></h2><h3 id="_2-1-1-镜像名称" tabindex="-1">2.1.1.镜像名称 <a class="header-anchor" href="#_2-1-1-镜像名称" aria-hidden="true">#</a></h3><p>首先来看下镜像的名称组成：</p><ul><li>镜名称一般分两部分组成：[repository]:[tag]。</li><li>在没有指定tag时，默认是latest，代表最新版本的镜像</li></ul><p>如图：</p><p><img src="`+u+'" alt="image-20210731155141362"></p><p>这里的mysql就是repository，5.7就是tag，合一起就是镜像名称，代表5.7版本的MySQL镜像。</p><h3 id="_2-1-2-镜像命令" tabindex="-1">2.1.2.镜像命令 <a class="header-anchor" href="#_2-1-2-镜像命令" aria-hidden="true">#</a></h3><p>常见的镜像操作命令如图：</p><p><img src="'+k+'" alt="image-20210731155649535"></p><h3 id="_2-1-3-案例1-拉取、查看镜像" tabindex="-1">2.1.3.案例1-拉取、查看镜像 <a class="header-anchor" href="#_2-1-3-案例1-拉取、查看镜像" aria-hidden="true">#</a></h3><p>需求：从DockerHub中拉取一个nginx镜像并查看</p><p>1）首先去镜像仓库搜索nginx镜像，比如<a href="https://hub.docker.com/" target="_blank" rel="noreferrer">DockerHub</a>:</p><p><img src="'+E+'" alt="image-20210731155844368"></p><p>2）根据查看到的镜像名称，拉取自己需要的镜像，通过命令：docker pull nginx</p><p><img src="'+_+'" alt="image-20210731155856199"></p><p>3）通过命令：docker images 查看拉取到的镜像</p><p><img src="'+b+`" alt="image-20210731155903037"></p><h3 id="_2-1-4-案例2-保存、导入镜像" tabindex="-1">2.1.4.案例2-保存、导入镜像 <a class="header-anchor" href="#_2-1-4-案例2-保存、导入镜像" aria-hidden="true">#</a></h3><p>需求：利用docker save将nginx镜像导出磁盘，然后再通过load加载回来</p><p>1）利用docker xx --help命令查看docker save和docker load的语法</p><p>例如，查看save命令用法，可以输入命令：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span></span>
<span class="line"></span></code></pre></div><p>结果：</p><p><img src="`+v+`" alt="image-20210731161104732"></p><p>命令格式：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">保存的目标文件名称</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">镜像名称</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>2）使用docker save导出镜像到磁盘</p><p>运行命令：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span></span>
<span class="line"></span></code></pre></div><p>结果如图：</p><p><img src="`+B+`" alt="image-20210731161354344"></p><p>3）使用docker load加载镜像</p><p>先删除本地的nginx镜像：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span></span>
<span class="line"></span></code></pre></div><p>然后运行命令，加载本地文件：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.tar</span></span>
<span class="line"></span></code></pre></div><p>结果：</p><p><img src="`+f+`" alt="image-20210731161746245"></p><h3 id="_2-1-5-练习" tabindex="-1">2.1.5.练习 <a class="header-anchor" href="#_2-1-5-练习" aria-hidden="true">#</a></h3><p><strong>需求：去DockerHub搜索并拉取一个Redis镜像</strong></p><p>目标：</p><p>1）去DockerHub搜索Redis镜像</p><p>2）查看Redis镜像的名称和版本</p><p>3）利用docker pull命令拉取镜像</p><p>4）利用docker save命令将 redis:latest打包为一个redis.tar包</p><p>5）利用docker rmi 删除本地的redis:latest</p><p>6）利用docker load 重新加载 redis.tar文件</p><h3 id="小结-镜像相关命令" tabindex="-1">小结：（镜像相关命令） <a class="header-anchor" href="#小结-镜像相关命令" aria-hidden="true">#</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1.查看 镜像：   ---&gt; 查看的是本地镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-q</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像名</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 查看一个</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2. 搜索镜像：   ---&gt; 搜索的是远程注册中心（仓库）的镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 3. 拉取镜像： （从注册中心 下载镜像到本地）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 4. 删除镜像： (先查询 再删除)</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像名（或者镜像id）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> images -q mysql</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 5. 导出镜像到磁盘 </span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">文件名</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像名:tag版本</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 6. 加载镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">文件名</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.tar</span></span>
<span class="line"></span></code></pre></div><p><img src="`+x+'" alt="1592730146935"></p><h2 id="_2-2-容器操作【掌握】" tabindex="-1">2.2.容器操作【掌握】 <a class="header-anchor" href="#_2-2-容器操作【掌握】" aria-hidden="true">#</a></h2><h3 id="_2-2-1-容器相关命令" tabindex="-1">2.2.1.容器相关命令 <a class="header-anchor" href="#_2-2-1-容器相关命令" aria-hidden="true">#</a></h3><p>容器操作的命令如图：</p><p><img src="'+q+`" alt="image-20210731161950495"></p><p>容器保护三个状态：</p><ul><li>运行：进程正常运行</li><li>暂停：进程暂停，CPU不再运行，并不释放内存</li><li>停止：进程终止，回收进程占用的内存、CPU等资源</li></ul><p>其中：</p><ul><li><p>docker run：创建并运行一个容器，处于运行状态</p></li><li><p>docker pause：让一个运行的容器暂停</p></li><li><p>docker unpause：让一个容器从暂停状态恢复运行</p></li><li><p>docker stop：停止一个运行的容器</p></li><li><p>docker start：让一个停止的容器再次运行</p></li><li><p>docker rm：删除一个容器</p></li></ul><h3 id="_2-2-2-查看容器" tabindex="-1">2.2.2 查看容器 <a class="header-anchor" href="#_2-2-2-查看容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 查看正在运行的容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">–a</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 查看所有容器，包括正在运行和停止的容器</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-3-创建并启动容器" tabindex="-1">2.2.3 创建并启动容器 <a class="header-anchor" href="#_2-2-3-创建并启动容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">参数</span></span>
<span class="line"></span></code></pre></div><p><strong>参数说明：</strong></p><p>• -i：保持容器运行。通常与 -t 同时使用。加入it这两个参数后，容器创建后自动进入容器中，退出容器后，容器自动关闭。</p><p>• -t：为容器重新分配一个伪输入终端，通常与 -i 同时使用。</p><p>• -d：以守护（后台）模式运行容器。创建一个容器在后台运行，需要使用docker exec 进入容器。退出后，容器不会关闭。</p><p>• -it 创建的容器一般称为交互式容器，-id 创建的容器一般称为守护式容器</p><p>• --name：为创建的容器命名。</p><p><strong>1）交互式容器</strong></p><p>以<strong>交互式</strong>方式创建并启动容器，启动完成后，直接进入当前容器。使用exit命令退出容器。需要注意的是以此种方式 启动容器，如果退出容器，则容器会进入<strong>停止</strong>状态。</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 先拉取一个镜像；这一步不是每次启动容器都要做的，而是因为前面我们删除了镜像，无镜像可用所以才再拉取一个 </span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos:</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#创建并启动名称为 mycentos7 的交互式容器；下面指令中的镜像名称 centos:7 也可以使用镜像id </span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=mycentos7</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos:</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><p><strong>2）守护式容器</strong></p><p>创建一个守护式容器；如果对于一个需要长期运行的容器来说，我们可以创建一个守护式容器。命令如下（容器名称 不能重复）：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#创建并启动守护式容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-id</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=mycentos2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos:</span><span style="color:#F78C6C;">7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#登录进入容器命令为：docker exec -it container_name (或者 container_id) /bin/bash（exit退出 时，容器不会停止）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mycentos2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><h4 id="小结-2" tabindex="-1">小结： <a class="header-anchor" href="#小结-2" aria-hidden="true">#</a></h4><p><strong>创建容器的两种方式：</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;"> 交互式创建：  创建容器后，直接进入容器内部；  ---</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 如果退出容器，容器自动停止！</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#FFCB6B;">-it</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#F78C6C;">2.</span><span style="color:#A6ACCD;"> 守护式创建：  创建容器后，不进入容器内部；   ---</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> 只要不手动停止，会一直在后台运行！</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#FFCB6B;">-di</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#FFCB6B;">启动容器有什么用？</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">---&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">可以根据需要通过镜像创建我们想要的容器，比如tomcat、mysql、jdk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">、redis</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">、</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">elasticsearch、mq......</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">---&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">可以实现快速创建我们想要的服务，不用我们自己一步一步安装，并且各种环境都是统一的！</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">体验：</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">创建tomcat容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=mytomcat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9003</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat</span></span>
<span class="line"></span></code></pre></div><p><img src="`+n+`" alt="image-20211025111445658"></p><h3 id="_2-2-4-进入容器" tabindex="-1">2.2.4 进入容器 <a class="header-anchor" href="#_2-2-4-进入容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">参数</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 退出容器，容器不会关闭</span></span>
<span class="line"><span style="color:#FFCB6B;">eg:</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mycentos2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-5-停止容器" tabindex="-1">2.2.5 停止容器 <a class="header-anchor" href="#_2-2-5-停止容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">容器名称或者容器id</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-6-启动容器" tabindex="-1">2.2.6 启动容器 <a class="header-anchor" href="#_2-2-6-启动容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">容器名称或者容器id</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-7-删除容器" tabindex="-1">2.2.7 删除容器 <a class="header-anchor" href="#_2-2-7-删除容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#删除指定容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">容器名称或者容器id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 删除所有容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> ps -a -q</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>注意：如果容器是运行状态则删除失败，需要停止容器才能删除</strong></p><h3 id="_2-2-8-案例-创建并运行一个容器" tabindex="-1">2.2.8 案例-创建并运行一个容器 <a class="header-anchor" href="#_2-2-8-案例-创建并运行一个容器" aria-hidden="true">#</a></h3><p><strong>体验： 创建tomcat容器：</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=mytomcat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9003</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat</span></span>
<span class="line"></span></code></pre></div><p><img src="`+n+`" alt="image-20211025111445658"></p><h3 id="_2-2-9-案例-进入容器-查看容器内部" tabindex="-1">2.2.9 案例-进入容器，查看容器内部 <a class="header-anchor" href="#_2-2-9-案例-进入容器-查看容器内部" aria-hidden="true">#</a></h3><p><strong>需求</strong>：容器内部，查看容器内部结构</p><p><strong>提示</strong>：进入容器要用到docker exec命令。</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 进入容器内部</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat9003</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><h3 id="小结-容器相关命令" tabindex="-1">小结：（容器相关命令） <a class="header-anchor" href="#小结-容器相关命令" aria-hidden="true">#</a></h3><blockquote><p><strong>docker run命令的常见参数有哪些？</strong></p><ul><li>--name：指定容器名称</li><li>-p：指定端口映射</li><li>-d：让容器后台运行</li></ul><p><strong>查看容器日志的命令：</strong></p><ul><li>docker logs</li><li>添加 -f 参数可以持续查看日志</li></ul><p><strong>查看容器状态：</strong></p><ul><li>docker ps</li><li>docker ps -a 查看所有容器，包括已经停止的</li></ul></blockquote><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1.查看容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;">  		</span><span style="color:#676E95;font-style:italic;"># 查看正在运行的容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> 	</span><span style="color:#676E95;font-style:italic;"># 查看所有容器， 包括已停止 和 正在运行的容器；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2.创建容器：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;"># 方式1： 守护式创建： -di   --&gt; 创建后不进入容器，后台自动运行  ，我们可以手动进入</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;"># 方式2： 交互式创建： -it   --&gt;创建后进入容器， 退出后，就停止了</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 3.停止容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器名</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器id</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ea023sdfs</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 4.启动容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器名</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器id</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ea023sdfs		</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 5.删除容器：    注意：rm   删除镜像 是rmi</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器名</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器id</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ea023sdfs		</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 6.端口映射： -p xxx:xxx   (主机端口和容器端口进行关联映射)</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机port</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器内部port</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 7 体验： 创建tomcat容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=mytomcat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10086</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">### 注意：  需要目录挂载时 、端口映射时，才添加 -p -v 参数，如果不需要时，可以不指定！</span></span>
<span class="line"><span style="color:#FFCB6B;">最简格式：</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">需要指定时：</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-v:</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机port</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器port</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机外部目录</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器内部目录</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="`+$+'" alt="image-20210102142146702"></p><blockquote><p>刚刚我们演示了tomcat，知道了容器和外界是隔绝的，是不能直接访问的， 不能直接的将文件放进容器中！</p><p>问题： 如果我们想将外边生成的项目war部署进tomcat容器，那应该怎么去操作？</p><p>解决访问： 数据卷!(本质就是目录挂载！)</p></blockquote><h2 id="_2-3-数据卷-容器数据管理" tabindex="-1">2.3.数据卷（容器数据管理） <a class="header-anchor" href="#_2-3-数据卷-容器数据管理" aria-hidden="true">#</a></h2><blockquote><p>本质： 就是文件夹的映射！ （目录挂载映射）</p></blockquote><p>在之前的案例中，进入容器内部。并且因为没有编辑器，修改文件也很麻烦。</p><p>这就是因为容器与数据（容器内文件）耦合带来的后果。</p><p><img src="'+j+'" alt="image-20210731172440275"></p><p>要解决这个问题，必须将数据与容器解耦，这就要用到数据卷了。</p><h4 id="思考" tabindex="-1"><strong>思考：</strong> <a class="header-anchor" href="#思考" aria-hidden="true">#</a></h4><blockquote><p>• Docker 容器删除后，在容器中产生的数据还在吗 ？---------------(会随之销毁 )</p><p>• Docker 容器和外部机器可以直接交换文件吗？</p><p>• 容器之间想要进行数据交互？</p></blockquote><p><img src="'+S+'" alt="1592748818477"></p><h3 id="_2-3-1-什么是数据卷" tabindex="-1">2.3.1.什么是数据卷 <a class="header-anchor" href="#_2-3-1-什么是数据卷" aria-hidden="true">#</a></h3><p>**数据卷（volume）**是一个虚拟目录，指向宿主机文件系统中的某个目录。</p><p><img src="'+O+'" alt="image-20210731173541846"></p><p>一旦完成数据卷挂载，对容器的一切操作都会作用在数据卷对应的宿主机目录了。</p><p>这样，我们操作宿主机的/var/lib/docker/volumes/html目录，就等于操作容器内的/usr/share/nginx/html目录了</p><blockquote><ul><li>数据卷是宿主机中的一个目录或文件</li><li>当容器目录和数据卷目录绑定后，对方的修改会立即同步</li><li>一个数据卷可以被多个容器同时挂载</li><li>一个容器也可以被挂载多个数据卷</li></ul><p><img src="'+T+`" alt="1592748888266"></p></blockquote><blockquote><p><strong>数据卷的作用</strong></p><p>• 容器数据持久化</p><p>• 外部机器和容器间接通信</p><p>• 容器之间数据交换</p></blockquote><h3 id="_2-3-2-数据集操作命令" tabindex="-1">2.3.2.数据集操作命令 <a class="header-anchor" href="#_2-3-2-数据集操作命令" aria-hidden="true">#</a></h3><p>数据卷操作的基本语法如下：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">COMMAND</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>docker volume命令是数据卷操作，根据命令后跟随的command来确定下一步的操作：</p><ul><li>create 创建一个volume</li><li>inspect 显示一个或多个volume的信息</li><li>ls 列出所有的volume</li><li>prune 删除未使用的volume</li><li>rm 删除一个或多个指定的volume</li></ul><h3 id="_2-3-3-创建和查看数据卷" tabindex="-1">2.3.3.创建和查看数据卷 <a class="header-anchor" href="#_2-3-3-创建和查看数据卷" aria-hidden="true">#</a></h3><p><strong>需求</strong>：创建一个数据卷，并查看数据卷在宿主机的目录位置</p><p>① 创建数据卷</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">html</span></span>
<span class="line"></span></code></pre></div><p>② 查看所有数据</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ls</span></span>
<span class="line"></span></code></pre></div><p>结果：</p><p><img src="`+R+`" alt="image-20210731173746910"></p><p>③ 查看数据卷详细信息卷</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">inspect</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">html</span></span>
<span class="line"></span></code></pre></div><p>结果：</p><p><img src="`+P+`" alt="image-20210731173809877"></p><p>可以看到，我们创建的html这个数据卷关联的宿主机目录为<code>/var/lib/docker/volumes/html/_data</code>目录。</p><p><strong>小结</strong>：</p><p>数据卷的作用：</p><ul><li>将容器与数据分离，解耦合，方便操作容器内数据，保证数据安全</li></ul><p>数据卷操作：</p><ul><li>docker volume create：创建数据卷</li><li>docker volume ls：查看所有数据卷</li><li>docker volume inspect：查看数据卷详细信息，包括关联的宿主机目录位置</li><li>docker volume rm：删除指定数据卷</li><li>docker volume prune：删除所有未使用的数据卷</li></ul><h3 id="_2-3-4-数据卷挂载" tabindex="-1">2.3.4.数据卷挂载 <a class="header-anchor" href="#_2-3-4-数据卷挂载" aria-hidden="true">#</a></h3><p>我们在创建容器时，可以通过 -v 参数来挂载一个数据卷到某个容器内目录，命令格式如下：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mn</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">html:/root/html</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">80</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"></span></code></pre></div><p>这里的-v就是挂载数据卷的命令：</p><ul><li><code>-v html:/root/htm</code> ：把html数据卷挂载到容器内的/root/html这个目录中</li></ul><h3 id="_2-3-5-目录挂载" tabindex="-1">2.3.5.目录挂载 <a class="header-anchor" href="#_2-3-5-目录挂载" aria-hidden="true">#</a></h3><p>容器不仅仅可以挂载数据卷，也可以直接挂载到宿主机目录上。关联关系如下：</p><blockquote><ul><li>带数据卷模式：宿主机目录 --&gt; 数据卷 ---&gt; 容器内目录</li><li>直接挂载模式：宿主机目录 ---&gt; 容器内目录</li></ul></blockquote><p>如图：</p><p><img src="`+L+`" alt="image-20210731175155453"></p><blockquote><p>目录挂载与数据卷挂载的语法是类似的：</p><ul><li>-v [宿主机目录]:[容器内目录]</li><li>-v [宿主机文件]:[容器内文件]</li></ul></blockquote><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 容器目录挂载： -v /xxx:/xxx （主机系统外部目录和容器内部目录进行关联映射）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机外部目录</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器内部目录</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-3-6-案例需求-部署一个网页项目到tomcat容器中" tabindex="-1">2.3.6.案例需求： 部署一个网页项目到tomcat容器中. <a class="header-anchor" href="#_2-3-6-案例需求-部署一个网页项目到tomcat容器中" aria-hidden="true">#</a></h3><p><strong>需求</strong>：部署一个网页项目到tomcat容器中.</p><p><strong>分析</strong>：我们进入tomcat容器内部，已经知道tomcat的webapp目录所在位置/usr/local/tomcat/webapps，我们需要把这个目录挂载到html这个数据卷上，方便操作其中的内容。</p><p><strong>提示</strong>：运行容器时使用 -v 参数挂载数据卷</p><p><strong>步骤：</strong></p><p>① 创建容器并挂载数据卷到容器内的HTML目录</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 数据卷挂载方式：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-id</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=c_tomcat</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-p </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v </span><span style="color:#C3E88D;">html:/usr/local/tomcat/webapps</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">tomcat </span></span>
<span class="line"></span></code></pre></div><p>② 进入html数据卷所在位置，并修改HTML内容</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看html数据卷的位置</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">inspect</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">html</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 进入该目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/lib/docker/volumes/html/_data</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 修改文件</span></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">index.html</span></span>
<span class="line"></span></code></pre></div><p>③使用外部机器访问tomcat</p><p><img src="`+M+'" alt="1573649804623"></p><h4 id="小结-3" tabindex="-1">小结： <a class="header-anchor" href="#小结-3" aria-hidden="true">#</a></h4><p><img src="'+Q+'" alt="image-20210202162536188"></p><p><img src="'+I+`" alt="image-20210102154718339"></p><h3 id="_2-3-7-案例-给mysql挂载本地目录" tabindex="-1">2.3.7.案例-给MySQL挂载本地目录 <a class="header-anchor" href="#_2-3-7-案例-给mysql挂载本地目录" aria-hidden="true">#</a></h3><h4 id="需求" tabindex="-1"><strong>需求</strong>： <a class="header-anchor" href="#需求" aria-hidden="true">#</a></h4><p>创建并运行一个MySQL容器，将宿主机目录直接挂载到容器</p><h4 id="部署mysql实现步骤" tabindex="-1">部署MySQL实现步骤： <a class="header-anchor" href="#部署mysql实现步骤" aria-hidden="true">#</a></h4><ol><li>搜索mysql镜像</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>拉取mysql镜像</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:</span><span style="color:#F78C6C;">5.6</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>创建容器，设置端口映射、目录映射</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 在/root目录下创建mysql目录用于存储mysql数据信息</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/mysql</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/mysql</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-id</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">--name=mysql01 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-p </span><span style="color:#F78C6C;">33306</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3306</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v $PWD</span><span style="color:#C3E88D;">/conf:/etc/mysql/conf.d</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v $PWD</span><span style="color:#C3E88D;">/logs:/logs</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-v $PWD</span><span style="color:#C3E88D;">/data:/var/lib/mysql</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=</span><span style="color:#F78C6C;">123456</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">mysql:5.6</span></span>
<span class="line"></span></code></pre></div><ul><li>参数说明： <ul><li><strong>-p 3307:3306</strong>：将容器的 3306 端口映射到宿主机的 3307 端口。</li><li><strong>-v $PWD/conf:/etc/mysql/conf.d</strong>：将主机当前目录下的 conf/my.cnf 挂载到容器的 /etc/mysql/my.cnf。配置目录</li><li><strong>-v $PWD/logs:/logs</strong>：将主机当前目录下的 logs 目录挂载到容器的 /logs。日志目录</li><li><strong>-v $PWD/data:/var/lib/mysql</strong> ：将主机当前目录下的data目录挂载到容器的 /var/lib/mysql 。数据目录</li><li>**-e MYSQL_ROOT_PASSWORD=123456：**初始化 root 用户的密码。</li></ul></li></ul><ol start="4"><li>进入容器，操作mysql</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">–it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">c_mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>使用外部机器连接容器中的mysql</li></ol><h4 id="小结-4" tabindex="-1">小结： <a class="header-anchor" href="#小结-4" aria-hidden="true">#</a></h4><p><img src="`+N+`" alt="image-20210102160247890"></p><h3 id="_2-3-8-部署redis" tabindex="-1">2.3.8 部署Redis <a class="header-anchor" href="#_2-3-8-部署redis" aria-hidden="true">#</a></h3><ol><li>搜索redis镜像</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>拉取redis镜像</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis:</span><span style="color:#F78C6C;">5.0</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>创建容器，设置端口映射</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-id</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=c_redis</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6379</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis:</span><span style="color:#F78C6C;">5.0</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>使用外部机器连接redis</li></ol><h3 id="_2-3-9-小结" tabindex="-1">2.3.9.小结 <a class="header-anchor" href="#_2-3-9-小结" aria-hidden="true">#</a></h3><p>docker run的命令中通过 -v 参数挂载文件或目录到容器中：</p><ul><li>-v volume名称:容器内目录</li><li>-v 宿主机文件:容器内文</li><li>-v 宿主机目录:容器内目录</li></ul><p>数据卷挂载与目录直接挂载的</p><ul><li>数据卷挂载耦合度低，由docker来管理目录，但是目录较深，不好找</li><li>目录挂载耦合度高，需要我们自己管理目录，不过目录容易寻找查看</li></ul><h1 id="_3-dockerfile自定义镜像" tabindex="-1">3.Dockerfile自定义镜像 <a class="header-anchor" href="#_3-dockerfile自定义镜像" aria-hidden="true">#</a></h1><p>常见的镜像在DockerHub就能找到，但是我们自己写的项目就必须自己构建镜像了。</p><p>而要自定义镜像，就必须先了解镜像的结构才行。</p><h2 id="_3-1-镜像结构" tabindex="-1">3.1.镜像结构 <a class="header-anchor" href="#_3-1-镜像结构" aria-hidden="true">#</a></h2><p>镜像是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成。</p><p>我们以MySQL为例，来看看镜像的组成结构：</p><p><img src="`+H+'" alt="image-20210731175806273"></p><p>简单来说，镜像就是在系统函数库、运行环境基础上，添加应用程序文件、配置文件、依赖文件等组合，然后编写好启动脚本打包在一起形成的文件。</p><p>我们要构建镜像，其实就是实现上述打包的过程。</p><h2 id="_3-2-dockerfile语法" tabindex="-1">3.2.Dockerfile语法 <a class="header-anchor" href="#_3-2-dockerfile语法" aria-hidden="true">#</a></h2><p>构建自定义的镜像时，并不需要一个个文件去拷贝，打包。</p><p>我们只需要告诉Docker，我们的镜像的组成，需要哪些BaseImage、需要拷贝什么文件、需要安装什么依赖、启动脚本是什么，将来Docker会帮助我们构建镜像。</p><p>而描述上述信息的文件就是Dockerfile文件。</p><p><strong>Dockerfile</strong>就是一个文本文件，其中包含一个个的<strong>指令(Instruction)</strong>，用指令来说明要执行什么操作来构建镜像。每一个指令都会形成一层Layer。</p><p><img src="'+U+'" alt="image-20210731180321133"></p><p>更新详细语法说明，请参考官网文档： <a href="https://docs.docker.com/engine/reference/builder" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/builder</a></p><h2 id="_3-3-构建java项目" tabindex="-1">3.3.构建Java项目 <a class="header-anchor" href="#_3-3-构建java项目" aria-hidden="true">#</a></h2><h3 id="_3-3-1-基于ubuntu构建java项目" tabindex="-1">3.3.1.基于Ubuntu构建Java项目 <a class="header-anchor" href="#_3-3-1-基于ubuntu构建java项目" aria-hidden="true">#</a></h3><p>需求：基于Ubuntu镜像构建一个新镜像，运行一个java项目</p><ul><li><p>步骤1：新建一个空文件夹docker-demo</p><p><img src="'+w+'" alt="image-20210801101207444"></p></li><li><p>步骤2：拷贝课前资料中的docker-demo.jar文件到docker-demo这个目录</p><p><img src="'+J+'" alt="image-20210801101314816"></p></li><li><p>步骤3：拷贝课前资料中的jdk8.tar.gz文件到docker-demo这个目录</p><p><img src="'+V+'" alt="image-20210801101410200"></p></li><li><p>步骤4：拷贝课前资料提供的Dockerfile到docker-demo这个目录</p><p><img src="'+W+`" alt="image-20210801101455590"></p><p>其中的内容如下：</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 指定基础镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM ubuntu:16.04</span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置环境变量，JDK的安装目录</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV JAVA_DIR=/usr/local</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 拷贝jdk和java项目的包</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./jdk8.tar.gz $JAVA_DIR/</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./docker-demo.jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 安装JDK</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN cd $JAVA_DIR \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; tar -xf ./jdk8.tar.gz \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; mv ./jdk1.8.0_144 ./java8</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置环境变量</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV JAVA_HOME=$JAVA_DIR/java8</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV PATH=$PATH:$JAVA_HOME/bin</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 暴露端口</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 8090</span></span>
<span class="line"><span style="color:#A6ACCD;"># 入口，java项目的启动命令</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT java -jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li><li><p>步骤5：进入docker-demo</p><p>将准备好的docker-demo上传到虚拟机任意目录，然后进入docker-demo目录下</p></li><li><p>步骤6：运行命令：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">javaweb:</span><span style="color:#F78C6C;">1.0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span></code></pre></div></li></ul><p>最后访问 <a href="http://192.168.150.101:8090/hello/count%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84ip%E6%94%B9%E6%88%90%E4%BD%A0%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BAip" target="_blank" rel="noreferrer">http://192.168.150.101:8090/hello/count，其中的ip改成你的虚拟机ip</a></p><h3 id="_3-3-2-基于java8构建java项目" tabindex="-1">3.3.2.基于java8构建Java项目 <a class="header-anchor" href="#_3-3-2-基于java8构建java项目" aria-hidden="true">#</a></h3><p>虽然我们可以基于Ubuntu基础镜像，添加任意自己需要的安装包，构建镜像，但是却比较麻烦。所以大多数情况下，我们都可以在一些安装了部分软件的基础镜像上做改造。</p><p>例如，构建java项目的镜像，可以在已经准备了JDK的基础镜像基础上构建。</p><p>需求：基于java:8-alpine镜像，将一个Java项目构建为镜像</p><p>实现思路如下：</p><ul><li><p>① 新建一个空的目录，然后在目录中新建一个文件，命名为Dockerfile</p></li><li><p>② 拷贝课前资料提供的docker-demo.jar到这个目录中</p></li><li><p>③ 编写Dockerfile文件：</p><ul><li><p>a ）基于java:8-alpine作为基础镜像</p></li><li><p>b ）将app.jar拷贝到镜像中</p></li><li><p>c ）暴露端口</p></li><li><p>d ）编写入口ENTRYPOINT</p><p>内容如下：</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">FROM java:8-alpine</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./app.jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 8090</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT java -jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div></li></ul></li><li><p>④ 使用docker build命令构建镜像</p></li><li><p>⑤ 使用docker run创建容器并运行</p></li></ul><h2 id="_3-4-小结" tabindex="-1">3.4.小结 <a class="header-anchor" href="#_3-4-小结" aria-hidden="true">#</a></h2><p>小结：</p><ol><li><p>Dockerfile的本质是一个文件，通过指令描述镜像的构建过程</p></li><li><p>Dockerfile的第一行必须是FROM，从一个基础镜像来构建</p></li><li><p>基础镜像可以是基本操作系统，如Ubuntu。也可以是其他人制作好的镜像，例如：java:8-alpine</p></li></ol><h1 id="_4-docker-compose" tabindex="-1">4.Docker-Compose <a class="header-anchor" href="#_4-docker-compose" aria-hidden="true">#</a></h1><p>Docker Compose可以基于Compose文件帮我们快速的部署分布式应用，而无需手动一个个创建和运行容器！</p><p><img src="`+Y+`" alt="image-20210731180921742"></p><h2 id="_4-1-初识dockercompose" tabindex="-1">4.1.初识DockerCompose <a class="header-anchor" href="#_4-1-初识dockercompose" aria-hidden="true">#</a></h2><p>Compose文件是一个文本文件，通过指令定义集群中的每个容器如何运行。格式如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">version: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.8</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"> services:</span></span>
<span class="line"><span style="color:#A6ACCD;">  mysql:</span></span>
<span class="line"><span style="color:#A6ACCD;">    image: mysql:</span><span style="color:#F78C6C;">5.7</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">25</span></span>
<span class="line"><span style="color:#A6ACCD;">    environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">     MYSQL_ROOT_PASSWORD: </span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">     - </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/tmp/mysql/data:/var/lib/mysql</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">     - </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  web:</span></span>
<span class="line"><span style="color:#A6ACCD;">    build: .</span></span>
<span class="line"><span style="color:#A6ACCD;">    ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">     - </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8090:8090</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>上面的Compose文件就描述一个项目，其中包含两个容器：</p><ul><li>mysql：一个基于<code>mysql:5.7.25</code>镜像构建的容器，并且挂载了两个目录</li><li>web：一个基于<code>docker build</code>临时构建的镜像容器，映射端口时8090</li></ul><p>DockerCompose的详细语法参考官网：<a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noreferrer">https://docs.docker.com/compose/compose-file/</a></p><p>其实DockerCompose文件可以看做是将多个docker run命令写到一个文件，只是语法稍有差异。</p><h2 id="_4-2-安装dockercompose" tabindex="-1">4.2.安装DockerCompose <a class="header-anchor" href="#_4-2-安装dockercompose" aria-hidden="true">#</a></h2><p>参考课前资料</p><h2 id="_4-3-部署微服务集群" tabindex="-1">4.3.部署微服务集群 <a class="header-anchor" href="#_4-3-部署微服务集群" aria-hidden="true">#</a></h2><p><strong>需求</strong>：将之前学习的cloud-demo微服务集群利用DockerCompose部署</p><p><strong>实现思路</strong>：</p><p>① 查看课前资料提供的cloud-demo文件夹，里面已经编写好了docker-compose文件</p><p>② 修改自己的cloud-demo项目，将数据库、nacos地址都命名为docker-compose中的服务名</p><p>③ 使用maven打包工具，将项目中的每个微服务都打包为app.jar</p><p>④ 将打包好的app.jar拷贝到cloud-demo中的每一个对应的子目录中</p><p>⑤ 将cloud-demo上传至虚拟机，利用 docker-compose up -d 来部署</p><h3 id="_4-3-1-compose文件" tabindex="-1">4.3.1.compose文件 <a class="header-anchor" href="#_4-3-1-compose文件" aria-hidden="true">#</a></h3><p>查看课前资料提供的cloud-demo文件夹，里面已经编写好了docker-compose文件，而且每个微服务都准备了一个独立的目录：</p><p><img src="`+z+`" alt="image-20210731181341330"></p><p>内容如下：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.2</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nacos</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nacos/nacos-server</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">MODE</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">standalone</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8848:8848</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mysql</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:5.7.25</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">MYSQL_ROOT_PASSWORD</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">$PWD/mysql/data:/var/lib/mysql</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">$PWD/mysql/conf:/etc/mysql/conf.d/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">userservice</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./user-service</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">orderservice</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./order-service</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">gateway</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./gateway</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10010:10010</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>可以看到，其中包含5个service服务：</p><ul><li><code>nacos</code>：作为注册中心和配置中心 <ul><li><code>image: nacos/nacos-server</code>： 基于nacos/nacos-server镜像构建</li><li><code>environment</code>：环境变量 <ul><li><code>MODE: standalone</code>：单点模式启动</li></ul></li><li><code>ports</code>：端口映射，这里暴露了8848端口</li></ul></li><li><code>mysql</code>：数据库 <ul><li><code>image: mysql:5.7.25</code>：镜像版本是mysql:5.7.25</li><li><code>environment</code>：环境变量 <ul><li><code>MYSQL_ROOT_PASSWORD: 123</code>：设置数据库root账户的密码为123</li></ul></li><li><code>volumes</code>：数据卷挂载，这里挂载了mysql的data、conf目录，其中有我提前准备好的数据</li></ul></li><li><code>userservice</code>、<code>orderservice</code>、<code>gateway</code>：都是基于Dockerfile临时构建的</li></ul><p>查看mysql目录，可以看到其中已经准备好了cloud_order、cloud_user表：</p><p><img src="`+K+'" alt="image-20210801095205034"></p><p>查看微服务目录，可以看到都包含Dockerfile文件：</p><p><img src="'+X+`" alt="image-20210801095320586"></p><p>内容如下：</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">FROM java:8-alpine</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./app.jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT java -jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="_4-3-2-修改微服务配置" tabindex="-1">4.3.2.修改微服务配置 <a class="header-anchor" href="#_4-3-2-修改微服务配置" aria-hidden="true">#</a></h3><p>因为微服务将来要部署为docker容器，而容器之间互联不是通过IP地址，而是通过容器名。这里我们将order-service、user-service、gateway服务的mysql、nacos地址都修改为基于容器名的访问。</p><p>如下所示：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">spring</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">datasource</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jdbc:mysql://mysql:3306/cloud_order?useSSL=false</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">driver-class-name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">application</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">orderservice</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">cloud</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">nacos</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">server-addr</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nacos:8848</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># nacos服务地址</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-3-3-打包" tabindex="-1">4.3.3.打包 <a class="header-anchor" href="#_4-3-3-打包" aria-hidden="true">#</a></h3><p>接下来需要将我们的每个微服务都打包。因为之前查看到Dockerfile中的jar包名称都是app.jar，因此我们的每个微服务都需要用这个名称。</p><p>可以通过修改pom.xml中的打包名称来实现，每个微服务都需要修改：</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- 服务打包的最终名称 --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">finalName</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">finalName</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">plugin</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">org.springframework.boot</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">spring-boot-maven-plugin</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">plugin</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>打包后：</p><p><img src="`+G+'" alt="image-20210801095951030"></p><h3 id="_4-3-4-拷贝jar包到部署目录" tabindex="-1">4.3.4.拷贝jar包到部署目录 <a class="header-anchor" href="#_4-3-4-拷贝jar包到部署目录" aria-hidden="true">#</a></h3><p>编译打包好的app.jar文件，需要放到Dockerfile的同级目录中。注意：每个微服务的app.jar放到与服务名称对应的目录，别搞错了。</p><p>user-service：</p><p><img src="'+Z+'" alt="image-20210801100201253"></p><p>order-service：</p><p><img src="'+ss+'" alt="image-20210801100231495"></p><p>gateway：</p><p><img src="'+as+'" alt="image-20210801100308102"></p><h3 id="_4-3-5-部署" tabindex="-1">4.3.5.部署 <a class="header-anchor" href="#_4-3-5-部署" aria-hidden="true">#</a></h3><p>最后，我们需要将文件整个cloud-demo文件夹上传到虚拟机中，理由DockerCompose部署。</p><p>上传到任意目录：</p><p><img src="'+ns+`" alt="image-20210801100955653"></p><p>部署：</p><p>进入cloud-demo目录，然后运行下面的命令：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"></span></code></pre></div><h1 id="_5-docker镜像仓库" tabindex="-1">5.Docker镜像仓库 <a class="header-anchor" href="#_5-docker镜像仓库" aria-hidden="true">#</a></h1><h2 id="_5-1-搭建私有镜像仓库" tabindex="-1">5.1.搭建私有镜像仓库 <a class="header-anchor" href="#_5-1-搭建私有镜像仓库" aria-hidden="true">#</a></h2><p>参考课前资料《<a href="http://xn--CentOS7Docker-hm0y4670c.md" target="_blank" rel="noreferrer">CentOS7安装Docker.md</a>》</p><h2 id="_5-2-推送、拉取镜像" tabindex="-1">5.2.推送、拉取镜像 <a class="header-anchor" href="#_5-2-推送、拉取镜像" aria-hidden="true">#</a></h2><p>推送镜像到私有镜像服务必须先tag，步骤如下：</p><p>① 重新tag本地镜像，名称前缀为私有仓库的地址：192.168.150.101:8080/</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tag</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.150.101:</span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">/nginx:</span><span style="color:#F78C6C;">1.0</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><p>② 推送镜像</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">push</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.150.101:</span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">/nginx:</span><span style="color:#F78C6C;">1.0</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><p>③ 拉取镜像</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">192.168.150.101:</span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">/nginx:</span><span style="color:#F78C6C;">1.0</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><hr><h1 id="作业" tabindex="-1">**作业： <a class="header-anchor" href="#作业" aria-hidden="true">#</a></h1><ul><li>完成docker常用镜像命令的练习；</li><li>练习常用容器相关命令；</li><li>练习在docker中部署mysql、tomcat、redis，并且能够通过Navicat crud数据库、浏览器访问tomcat;</li><li>完成后记得预习</li></ul><h1 id="总结" tabindex="-1">**总结： <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h1><h4 id="相关概念" tabindex="-1"><strong>相关概念：</strong> <a class="header-anchor" href="#相关概念" aria-hidden="true">#</a></h4><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">docker是什么： </span></span>
<span class="line"><span style="color:#A6ACCD;">	是一个容器化技术。用户操作 Docker 的容器就像操作一个快速轻量级的虚拟机一样简单。</span></span>
<span class="line"><span style="color:#A6ACCD;">作用： </span></span>
<span class="line"><span style="color:#A6ACCD;">	能够快速创建环境统一的容器，保证每一个容器的配置都是一样的；</span></span>
<span class="line"><span style="color:#A6ACCD;">	极大的提升部署的效率，减少部署出现的各种环境问题.</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>==其实我们使用docker，主要就是使用<strong>常见的 镜像和容器相关的命令</strong>，来满足我们的需要。==</p><h4 id="常用命令" tabindex="-1">常用命令： <a class="header-anchor" href="#常用命令" aria-hidden="true">#</a></h4><h5 id="docker服务命令" tabindex="-1">docker服务命令： <a class="header-anchor" href="#docker服务命令" aria-hidden="true">#</a></h5><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1. docker 服务相关命令： centos 6</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span></span>
<span class="line"><span style="color:#FFCB6B;">servcie</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 上面这些命令  systemctl xxx docker 是一样的  centos 7</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span></code></pre></div><h5 id="镜像常用命令" tabindex="-1">镜像常用命令： <a class="header-anchor" href="#镜像常用命令" aria-hidden="true">#</a></h5><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1.查看 镜像：   ---&gt; 查看的是本地镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2.搜索镜像：   ---&gt; 搜索的是远程注册中心（仓库）的镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">镜像名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 3.拉取镜像： （从注册中心 下载镜像到本地）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 4.删除镜像： (先查询 再删除)</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">02ae15dfgd</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">镜像id</span></span>
<span class="line"></span></code></pre></div><h5 id="容器常用命令" tabindex="-1">容器常用命令： <a class="header-anchor" href="#容器常用命令" aria-hidden="true">#</a></h5><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1.查看容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;">  		</span><span style="color:#676E95;font-style:italic;"># 查看正在运行的容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> 	</span><span style="color:#676E95;font-style:italic;"># 查看所有容器， 包括已停止 和 正在运行的容器；</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2.创建容器：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;"># 方式1： 守护式创建： -di   --&gt; 创建后不进入容器，后台自动运行  ，我们可以手动进入( docker exec -it 容器名 /bin/bash )</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;"># 方式2： 交互式创建： -it   --&gt;创建后进入容器， 退出后，就停止了</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 3.停止容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器名</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器id</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ea023sdfs</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 4.启动容器：</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器名</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器id</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ea023sdfs		</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 5.删除容器：    注意：rm   删除镜像 是rmi</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器名</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">容器id</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ea023sdfs		</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 6.容器目录挂载(数据卷)： -v /xxx:/xxx （主机系统外部目录和容器内部目录进行关联映射）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机外部目录</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器内部目录</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTom</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/host/webapps:/usr/local/tomcat/webapps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 7.端口映射： -p xxx:xxx   (主机端口和容器端口进行关联映射)</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机port</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器内部port</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myTom</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10086</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8080</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">### 注意：  需要目录挂载时 、端口映射时，才添加 -p -v 参数，如果不需要时，可以不指定！</span></span>
<span class="line"><span style="color:#FFCB6B;">最简格式：</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">你自己的容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">需要指定时：</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-v:</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-di</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name=</span><span style="color:#89DDFF;">\${</span><span style="color:#C3E88D;">容器名</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机port</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器port</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">主机外部目录</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">容器内部目录</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像名</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">镜像的tag</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><hr><h1 id="补充说明" tabindex="-1">**补充说明： <a class="header-anchor" href="#补充说明" aria-hidden="true">#</a></h1><h3 id="_1-ip-addr不显示ip地址怎么办" tabindex="-1">1. ip addr不显示ip地址怎么办？ <a class="header-anchor" href="#_1-ip-addr不显示ip地址怎么办" aria-hidden="true">#</a></h3><blockquote><ol><li><p>重启虚拟机</p></li><li><p>通过命令重启网卡</p><p><img src="`+ls+'" alt="image-20220213144552867"></p></li></ol></blockquote><p><strong>问题： 搜索镜像报509：</strong></p><p><img src="'+ps+'" alt="1592729755943"></p><p><strong>关于我们以后是否需要部署项目：</strong></p><blockquote><p>基本上以后配置、部署这些事情，都是有运维去完成的，而且我们在公司的服务器上也没有root用户权限，有些操作是知道，后面可能你没有操作的机会，但是你要理解。（如果你以后独当一面，一个人搞所有，这个时候就派上用场了。）</p></blockquote>',351);function rs(is,Cs,ys,Ds,ds,As){const s=p;return t(),e("div",null,[es,a(s,{src:"assets/image-20210731145914960.png",alt:"image-20210731145914960",style:{zoom:"33%"}}),cs,a(s,{src:"assets/image-20210731152243765.png",alt:"image-20210731152243765",style:{zoom:"33%"}}),ts])}const ms=o(os,[["render",rs]]);export{gs as __pageData,ms as default};
